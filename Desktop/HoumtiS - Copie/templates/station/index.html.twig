{% extends 'base.html.twig' %}

{% block title %}Liste des Stations{% endblock %}

{% block body %}
<div class="container mt-4">
    <h1>Gestion des Stations</h1>

    {# Barre de recherche #}
    <div class="card mb-4">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="input-group">
                        <input type="text" id="searchInput" class="form-control" placeholder="Rechercher une station..." value="{{ search|default('') }}">
                        <button class="btn btn-outline-secondary" type="button" id="clearSearch">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="col-md-4">
                    <select id="zoneFilter" class="form-select">
                        <option value="">Toutes les zones</option>
                        <option value="Nord" {% if zone_search == 'Nord' %}selected{% endif %}>Nord</option>
                        <option value="Sud" {% if zone_search == 'Sud' %}selected{% endif %}>Sud</option>
                        <option value="Est" {% if zone_search == 'Est' %}selected{% endif %}>Est</option>
                        <option value="Ouest" {% if zone_search == 'Ouest' %}selected{% endif %}>Ouest</option>
                        <option value="Centre" {% if zone_search == 'Centre' %}selected{% endif %}>Centre</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <a href="{{ path('app_station_new') }}" class="btn btn-primary w-100">
                        <i class="fas fa-plus"></i> Nouvelle Station
                    </a>
                </div>
            </div>
        </div>
    </div>

    {# Contenu dynamique #}
    <div id="stationsContent">
        {{ include('station/_stations_list.html.twig') }}
    </div>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const zoneFilter = document.getElementById('zoneFilter');
            const clearSearch = document.getElementById('clearSearch');
            const stationsContent = document.getElementById('stationsContent');
            let searchTimeout;

            function updateResults() {
                const searchTerm = searchInput.value;
                const zone = zoneFilter.value;
                
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    const url = new URL(window.location.href);
                    url.searchParams.set('search', searchTerm);
                    url.searchParams.set('zone', zone);
                    url.searchParams.set('ajax', '1');

                    fetch(url)
                        .then(response => response.text())
                        .then(html => {
                            stationsContent.innerHTML = html;
                        });
                }, 300);
            }

            searchInput.addEventListener('input', updateResults);
            zoneFilter.addEventListener('change', updateResults);
            
            clearSearch.addEventListener('click', () => {
                searchInput.value = '';
                updateResults();
            });
        });
    </script>
{% endblock %}