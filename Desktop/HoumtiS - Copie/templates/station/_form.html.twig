{# templates/station/_form.html.twig #}
{{ form_start(form, {'attr': {'novalidate': 'novalidate'}}) }}
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h5 class="card-title mb-0">{{ title|default('Formulaire de station') }}</h5>
        </div>
        <div class="card-body">
            {% if form_errors(form) %}
                <div class="alert alert-danger">
                    {{ form_errors(form) }}
                </div>
            {% endif %}
            
            <div class="row">
                <div class="col-md-6">
                    {{ form_row(form.nomStation) }}
                    {{ form_row(form.capacite) }}
                    {{ form_row(form.zone) }}
                    {{ form_row(form.status) }}
                </div>
                <div class="col-md-6">
                    {{ form_row(form.latitude) }}
                    {{ form_row(form.longitude) }}
                    <div id="map" style="height: 300px; margin-bottom: 20px;"></div>
                </div>
            </div>
        </div>
        <div class="card-footer">
            <button class="btn btn-primary">{{ button_label|default('Enregistrer') }}</button>
            <a href="{{ path('app_station_index') }}" class="btn btn-secondary">Annuler</a>
        </div>
    </div>
{{ form_end(form) }}

{% block javascripts %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var map = L.map('map').setView([33.5731, -7.5898], 13); // Coordonnées de Casablanca
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        var marker;
        
        // Ajouter un marqueur si les coordonnées existent
        var lat = document.querySelector('#station_latitude').value;
        var lng = document.querySelector('#station_longitude').value;
        if (lat && lng) {
            marker = L.marker([lat, lng]).addTo(map);
            map.setView([lat, lng], 13);
        }

        // Mettre à jour les coordonnées lors d'un clic sur la carte
        map.on('click', function(e) {
            if (marker) {
                map.removeLayer(marker);
            }
            marker = L.marker(e.latlng).addTo(map);
            document.querySelector('#station_latitude').value = e.latlng.lat.toFixed(6);
            document.querySelector('#station_longitude').value = e.latlng.lng.toFixed(6);
        });
    });
</script>
{% endblock %}